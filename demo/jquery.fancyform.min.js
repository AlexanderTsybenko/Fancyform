/*!
* Fancyform - jQuery Plugin
* Simple and fancy form styling alternative
*
* Examples and documentation at: https://github.com/Lutrasoft/Fancyform
*
* Copyright (c) 2010-2013 - Lutrasoft
*
* Version: 1.3.8
* Requires: jQuery v1.6.1+
*
* Dual licensed under the MIT and GPL licenses:
*   http://www.opensource.org/licenses/mit-license.php
*   http://www.gnu.org/licenses/gpl.html
*/
(function(b){b.simpleEllipsis=function(d,f){return d.length<f?d:d.substring(0,f)+"..."};var a=!!("ontouchstart" in window);b.fn.extend({caret:function(j,c){var g=this[0],i=this.val(),f,d,h;if(g){if(typeof j=="undefined"){if(g.selectionStart){j=g.selectionStart;c=g.selectionEnd}else{if(document.selection){this.focus();f=document.selection.createRange();if(f==null){return{start:0,end:e.value.length,length:0}}d=g.createTextRange();h=d.duplicate();d.moveToBookmark(f.getBookmark());h.setEndPoint("EndToStart",d);return{start:h.text.length-(h.text.split("\n").length+1)+2,end:h.text.length+f.text.length-(h.text.split("\n").length+1)+2,length:f.text.length,text:f.text}}}}else{if(typeof c!="number"){c=-1}if(typeof j!="number"||j<0){j=0}if(c>i.length){c=i.length}c=Math.max(j,c);j=Math.min(j,c);g.focus();if(g.selectionStart){g.selectionStart=j;g.selectionEnd=c}else{if(document.selection){f=g.createTextRange();f.collapse(true);f.moveStart("character",j);f.moveEnd("character",c-j);f.select()}}}return{start:j,end:c}}},transformRadio:function(c){var d={base:"image",checked:"",unchecked:"",disabledChecked:"",disabledUnchecked:"",trigger:"self"};var c=b.extend(d,c),f={_removeClasses:function(){var i=b(this),h=i.data("options"),g;for(g in h){i.parent().removeClass(g)}},imageClick:function(){var h=b(this),g=h.attr("name");if(!h.is(":disabled")){b("input[name='"+g+"']").prop("checked",0).each(function(){f.setImage.call(this)});h.prop("checked",1).change();f.setImage.call(h)}},setImage:function(){var j=b(this),g=j.is(":disabled"),h=j.data("options"),i=j.is(":checked")?(g?"disabledChecked":"checked"):(g?"disabledUnchecked":"unchecked");if(h.base=="image"){if(!j.next().is("img")){j.after("<img />")}j.next("img").attr("src",h[i])}else{if(!j.parent().is("span")){j.wrap("<span class='trans-element-radio' />")}f._removeClasses.call(this);j.parent().addClass(i)}}};return this.each(function(){var g=b(this);if(!g.data("tfr.init")){g.data("tfr.init",1).hide().data("options",c);f.setImage.call(this);if(c.base=="image"){switch(c.trigger){case"parent":g.parent().click(function(){f.imageClick.call(g)});break;case"self":g.nextAll("img:first").click(b.proxy(f.imageClick,g));break}}else{g.parent().click(b.proxy(f.imageClick,this))}}})},transformCheckbox:function(d){var f={checked:"",unchecked:"",disabledChecked:"",disabledUnchecked:"",tristateHalfChecked:"",changeHandler:function(h){},trigger:"self",tristate:0},c=b.extend(f,d),g={setImage:function(){var h=b(this),i=h.next(),j=h.data("settings"),k;if(h.is(":disabled")){k=h.is(":checked")?"disabledChecked":"disabledUnchecked"}else{if(h.hasClass("half-checked")){k="tristateHalfChecked"}else{if(h.is(":checked")){k="checked"}else{k="unchecked"}}}i.attr("src",j[k])},setProp:function(j,i,h){b(j).prop(i,h).change();g.setImage.call(j)},uncheck:function(){g.setProp(this,"checked",0)},check:function(){g.setProp(this,"checked",1)},disable:function(){g.setProp(this,"disabled",1)},enable:function(){g.setProp(this,"disabled",0)},imageClick:function(){var h=b(this).prev();if(!h.is(":disabled")){if(h.is(":checked")){g.uncheck.call(h);c.changeHandler.call(h,1)}else{g.check.call(h);c.changeHandler.call(h,0)}g.handleTriState.call(h)}},handleTriState:function(){var i=b(this),l=i.data("settings"),h=i.parent(),k=h.find("ul"),j=h.closest("li");if(l.tristate){if(i.hasClass("half-checked")||i.is(":checked")){i.removeClass("half-checked");g.check.call(i);k.find("input:checkbox").each(g.check)}else{if(i.not(":checked")){i.removeClass("half-checked");k.find("input:checkbox").each(g.uncheck)}}g.setImage.call(i);if(i.parent().parent().parent().is("li")){g.handleTriStateLevel.call(i.parent().parent().parent())}i.trigger("transformCheckbox.tristate")}},handleTriStateLevel:function(){var l=b(this),i=l.find("input:checkbox").first(),j=l.find("ul"),h=j.find("input:checkbox"),k=h.filter(":checked");i.removeClass("half-checked");if(h.length==k.length){g.check.call(i)}else{if(k.length){i.addClass("half-checked")}else{g.uncheck.call(i)}}g.setImage.call(i);if(l.parent().parent().is("li")){g.handleTriStateLevel.call(l.parent().parent())}}};return this.each(function(){if(typeof d=="string"){g[d].call(this)}else{var h=b(this);if(!h.data("tfc.init")){h.data("tfc.init",1).data("settings",c);h.hide();h.after("<img />");g.setImage.call(this);switch(c.trigger){case"parent":h.parent().click(function(){g.imageClick.call(h.nextAll("img:first"))});break;case"self":h.next("img").click(g.imageClick);break}}}})},transformSelect:function(d){var f={dropDownClass:"transformSelect",showFirstItemInDrop:1,acceptManualInput:0,useManualInputAsFilter:0,subTemplate:function(h){if(b(this)[0].type=="select-multiple"){return"<span><input type='checkbox' value='"+b(h).val()+"' "+(b(h).is(":selected")?"checked='checked'":"")+" name='"+b(this).attr("name").replace("_backup","")+"' />"+b(h).text()+"</span>"}else{return"<span>"+b(h).text()+"</span>"}},initValue:function(){return b(this).text()},valueTemplate:function(){return b(this).text()},ellipsisLength:null,addDropdownToBody:0};var c=b(this).data("settings"),g={init:function(){var l=this,p=b(l),i=0,j=p.find("option:first");p.hide();if(p.find("option:selected").length&&l.type!="select-multiple"){j=p.find("option:selected");i=p.find("option").index(j)}var n="<ul class='"+c.dropDownClass+" trans-element'><li>";if(c.acceptManualInput&&!a){var o=p.data("value")||c.initValue.call(j);n+="<ins></ins><input type='text' name='"+p.attr("name").replace("_backup","")+"' value='"+o+"' />";if(p.attr("name").indexOf("_backup")<0){p.attr("name",p.attr("name")+"_backup")}}else{if(c.ellipsisLength){n+='<span title="'+j.text()+'">'+b.simpleEllipsis(c.initValue.call(j),c.ellipsisLength)+"</span>"}else{n+="<span>"+c.initValue.call(j)+"</span>"}}n+="<ul style='display: none;'>";p.children().each(function(q){if(!q&&!c.showFirstItemInDrop){}else{n+=g[this.tagName=="OPTION"?"getLIOptionChild":"getLIOptgroupChildren"].call(l,this)}});n+="</ul></li></ul>";var k=b(n),m=k.find("ul li:not(.group)"),h=k.find("input");p.after(k);if(p.is(":disabled")){g.disabled.call(l,1)}if(l.type=="select-multiple"&&!a){if(p.attr("name")&&p.attr("name").indexOf("_backup")==-1){p.attr("name",p.attr("name")+"_backup")}m.click(g.selectCheckbox)}else{m.click(g.selectNewValue);h.click(g.openDrop).keydown(function(q){if(b.inArray(q.which,[9,13])>=0){g.closeAllDropdowns()}}).prev("ins").click(g.openDrop)}if(c.useManualInputAsFilter){h.keyup(g.filterByInput)}k.find("span:first").click(g.openDrop);k.find("ul:first").data("trans-element",k).addClass("transformSelectDropdown");k.data("trans-element-drop",k.find("ul:first"));if(c.addDropdownToBody){k.find("ul:first").appendTo("body")}b("html").unbind("click.transformSelect").bind("click.transformSelect",g.closeDropDowns);if(b.hotkeys&&!b("body").data("trans-element-select")){b("body").data("trans-element-select",1);b(document).bind("keydown","up",function(t){var s=b(".trans-focused"),r,q;if(!s.length||s.find("input").length){return 0}r=s.prevAll("select").first();q=r[0].selectedIndex-1;if(q<0){q=r.find("option").length-1}g.selectIndex.call(r,q);return 0}).bind("keydown","down",function(t){var s=b(".trans-focused"),r,q;if(!s.length||s.find("input").length){return 0}r=s.prevAll("select").first();q=r[0].selectedIndex+1;if(q>r.find("option").length-1){q=0}g.selectIndex.call(r,q);return 0})}if(a){if(!c.showFirstItemInDrop){p.find("option:first").remove()}p.appendTo(k.find("li:first")).show().css({opacity:0,position:"absolute",width:"100%",height:"100%",left:0,top:0});k.find("li:first").css({position:"relative"});p.change(g.mobileChange)}},getUL:function(){return a?b(this).closest("ul"):b(this).next(".trans-element:first")},getSelect:function(h){return a?h.find("select"):h.prevAll("select:first")},disabled:function(h){g.getUL.call(this)[h?"addClass":"removeClass"]("disabled")},repaint:function(){var h=g.getUL.call(this);h.data("trans-element-drop").remove();h.remove();g.init.call(this)},filterByInput:function(){var l=b(this),k=l.val().toLowerCase(),j=l.closest("ul"),i=j.data("trans-element-drop"),h=i.find("li");if(!k){h.show()}else{h.each(function(){var m=b(this);if(!!m.data("settings").alwaysvisible){m.show()}else{m[m.text().toLowerCase().indexOf(k)<0?"hide":"show"]()}})}},selectIndex:function(j){var h=b(this),k=g.getUL.call(this),i=k.data("trans-element-drop");try{i.find("li").filter(function(){}).first().trigger("click");return b(this).text()==h.find("option").eq(j).text()}catch(l){}},selectValue:function(k){var h=b(this),j=g.getUL.call(this),i=j.data("trans-element-drop");g.selectIndex.call(this,h.find(k?"option[value='"+k+"']":"option:not([value])").index())},getLIOptionChild:function(i){var h=b(i).attr("data-settings");if(h){h="data-settings='"+h+"'"}h+=" class='"+b(i).attr("class")+"'";return"<li "+h+">"+c.subTemplate.call(this,b(i))+"</li>"},getLIOptgroupChildren:function(i){var j=this,h="<li class='group'><span>"+b(i).attr("label")+"</span><ul>";b(i).find("option").each(function(){h+=g.getLIOptionChild.call(j,this)});h+="</ul></li>";return h},getLIIndex:function(i){var h=0,k,j;if(i.closest(".group").length){k=i.closest(".group");h=i.closest(".transformSelectDropdown").find("li").index(i)-k.prevAll(".group").length-1}else{h=i.parent().find("li").index(i);if(!c.showFirstItemInDrop){h+=1}h-=i.prevAll(".group").length}return h},selectNewValue:function(){var l=b(this),k=l.closest(".transformSelectDropdown"),j=k.data("trans-element"),h=g.getSelect(j),i=g.getLIIndex(l);h[0].selectedIndex=i;if(j.find("input").length){j.find("input").val(c.valueTemplate.call(l))}else{sel=h.find("option:selected");j.find("span:first").html(c.ellipsisLength?b.simpleEllipsis(c.valueTemplate.call(sel),c.ellipsisLength):c.valueTemplate.call(sel))}g.closeAllDropdowns();h.trigger("change");b(".trans-element").removeClass("trans-focused");j.addClass("trans-focused");if(b.fn.validate){h.valid()}},mobileChange:function(){},selectCheckbox:function(m){var k=b(this),h=k.closest(".transformSelectDropdown"),i=h.data("trans-element"),n=g.getSelect(i),p=k.closest("li"),j=p.find(":checkbox"),l,o;if(b(m.target).is("li")){p=k}l=g.getLIIndex(p);if(!b(m.target).is(":checkbox")){j.prop("checked",!j.is(":checked"))}n.find("option").eq(l).prop("selected",j.is(":checked"));if(j.data("tfc.init")){j.transformCheckbox("setImage")}if(!b(m.target).is(":checkbox")){j.change()}n.change()},openDrop:function(){var i=b(this).closest(".trans-element"),h=i.data("trans-element-drop"),j=b(this).parent();if(i.hasClass("disabled")){return 0}if(j.hasClass("open")&&!b(this).is("input")){g.closeAllDropdowns()}else{j.css({"z-index":1200}).addClass("open");h.css({"z-index":1200}).show();g.hideAllOtherDropdowns.call(this)}if(c.addDropdownToBody){h.css({position:"absolute",top:j.offset().top+j.outerHeight(),left:j.offset().left})}},hideAllOtherDropdowns:function(){var i=b("body").find("*"),h=i.index(b(this).parent());b("body").find("ul.trans-element").each(function(){var j=b(this).data("trans-element-drop");if(h-1!=i.index(b(this))){j.hide().css("z-index",0).parent().css("z-index",0).removeClass("open")}})},closeDropDowns:function(h){if(!b(h.target).closest(".trans-element").length){g.closeAllDropdowns()}},closeAllDropdowns:function(){b("ul.trans-element").each(function(){b(this).data("trans-element-drop").hide();b(this).find("li:first").removeClass("open")}).removeClass("trans-focused")}};if(typeof d=="string"){g[d].apply(this,Array.prototype.slice.call(arguments,1));return this}return this.each(function(){var h=b(this);if(!h.data("tfs.init")){c=b.extend(f,d);h.data("settings",c);h.data("tfs.init",1);g.init.call(this)}})},transformFile:function(c){var d={file:function(g,f){return this.each(function(){var k=b(this),j=b("<div></div>").appendTo(k).css({position:"absolute",overflow:"hidden","-moz-opacity":"0",filter:"alpha(opacity: 0)",opacity:"0",zoom:"1",width:k.outerWidth()+"px",height:k.outerHeight()+"px","z-index":1}),n=0,l,i=function(){var p=l=j.html("<input "+(window.FormData?"multiple ":"")+'type="file" style="border:none; position:absolute">').find("input");n=n||p.width();p.change(function(){p.unbind("change");i();g(p[0])})},h=function(p){j.offset(k.offset());if(p){l.offset({left:p.pageX-n+25,top:p.pageY-10});o()}},o=function(){k.addClass(f+"MouseOver")},m=function(){k.removeClass(f+"MouseOver")};i();k.mouseover(h);k.mousemove(h);k.mouseout(m);h()})}};return this.each(function(j){if(!b(this).data("tff.init")){b(this).data("tff.init",1);var k=b(this).hide(),l=null,h=k.attr("name"),f=(!c?"customInput":(c.cssClass?c.cssClass:"customInput")),g=(!c?"Browse...":(c.label?c.label:"Browse..."));if(!k.attr("id")){k.attr("id","custom_input_file_"+(new Date().getTime())+Math.floor(Math.random()*100000))}l=k.attr("id");k.after('<span id="'+l+'_custom_input" class="'+f+'"><span class="inputPath" id="'+l+'_custom_input_path">&nbsp;</span><span class="inputButton">'+g+"</span></span>");d.file.call(b("#"+l+"_custom_input"),function(i){i.id=l;i.name=h;b("#"+l).replaceWith(i).removeAttr("style").hide();b("#"+l+"_custom_input_path").html(b("#"+l).val().replace(/\\/g,"/").replace(/.*\//,""))},f)}})},transformTextarea:function(d,c){var g={hiddenTextareaClass:"hiddenTextarea"},f=b.extend(g,d),h={init:function(){var j=b(this);if(j.css("line-height")=="normal"){j.css("line-height","12px")}var i={"line-height":j.css("line-height"),"font-family":j.css("font-family"),"font-size":j.css("font-size"),border:"1px solid black",width:j.width(),"letter-spacing":j.css("letter-spacing"),"text-indent":j.css("text-indent"),padding:j.css("padding"),overflow:"hidden","white-space":j.css("white-space")};j.css(i).keyup(h.keyup).keydown(h.keyup).bind("mousewheel",h.mousewheel).after(b("<div />")).next().addClass(f.hiddenTextareaClass).css(i).css("width",j.width()-5).hide()},mousewheel:function(k,l){k.preventDefault();var j=b(this).css("line-height"),i=b(this)[0].scrollTop+(parseFloat(j)*(l*-1));h.scrollToPx.call(this,i)},keyup:function(i){if(b.inArray(i.which,[37,38,39,40])>=0){h.checkCaretScroll.call(this)}else{h.checkScroll.call(this,i.which)}h.scrollCallBack.call(this)},checkCaretScroll:function(){var i=b(this),l=i.caret().start,j=i.val(),p=i.scrollTop(),m=parseInt(i.css("line-height")),n=j.substr(0,l),o=j.substr(l),k=i.next("."+f.hiddenTextareaClass),q;if(l){if(j.substr(l-1,1)=="\n"){n=j.substr(0,l+1)}h.toDiv.call(this,0,n,o);if(k.height()>(i.height()+p)){q=p+m}else{if(k.height()<=p){q=p-m}}if(q){h.scrollToPx.call(this,q)}}},checkScroll:function(l){var p=b(this),i=p.next("."+f.hiddenTextareaClass),n=p.caret().start,k=p.val(),m=k.substr(0,n),j=k.substr(n);h.toDiv.call(this,1,m,j);if((p.scrollTop()+p.height())>i.height()){return}if(i.data("old-height")!=i.data("new-height")){var o=i.data("new-height")-i.data("old-height");h.scrollToPx.call(this,p.scrollTop()+o)}},toDiv:function(o,k,m){var i=b(this),l=i.next("."+f.hiddenTextareaClass),j=/\n/g,p=/\s\s/g,s=/\s/g,n=i.val(),q=0,r=0;if(k){n=k}if(j.test(n.substring(n.length-1))){q=1}if(j.test(n.substring(n.length-2,n.length-1))&&s.test(n.substring(n.length-1))){r=1}if(o){l.data("old-height",l.height())}n=n.replace(j,"<br>").replace(p,"&nbsp; ").replace(p,"&nbsp; ").replace(/<br>/ig,"<br />");l.html(n);if((q||r)&&b.trim(m)){if(r&&b.browser.msie){l.append("<br />")}l.append("<br />")}if(o){l.data("new-height",l.height())}},scrollToPercentage:function(k){if(k>=0&&k<=100){var m=b(this),i=m.next("."+f.hiddenTextareaClass),l=parseFloat(m[0].scrollHeight)-m.height(),j=l*k/100;h.scrollToPx.call(this,j)}},scrollToPx:function(i){b(this).scrollTop(h.roundToLineHeight.call(this,i));h.scrollCallBack.call(this)},roundToLineHeight:function(i){return Math.ceil(i/parseInt(b(this).css("line-height")))*parseInt(b(this).css("line-height"))},remove:function(){b(this).unbind("keyup").css({overflow:"auto",border:""}).next("div").remove()},scrollCallBack:function(){var j=parseFloat(b(this)[0].scrollHeight)-b(this).height(),i=parseFloat(b(this)[0].scrollTop)/j*100;i=i>100?100:i;i=i<0?0:i;i=isNaN(i)?100:i;b(this).trigger("scrollToPx",[b(this)[0].scrollTop,i])}};if(typeof d=="string"){h[d].call(this,c);return this}return this.each(function(){if(!b(this).next().hasClass(f.hiddenTextareaClass)){h.init.call(this);h.toDiv.call(this,1)}})}})})(jQuery);